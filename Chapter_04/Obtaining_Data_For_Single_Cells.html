
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>4.1. Obtaining Data for Single Cells &#8212; Teaching &amp; Learning with NWB Datasets</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet" />
  <link href="../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.acff12b8f9c144ce68a297486a2fa670.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="4.2. Analyzing Computed Features" href="Analyzing_Computed_Features.html" />
    <link rel="prev" title="4. Single-Cell Electrophysiology" href="Single-Cell_Electrophysiology.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      <img src="../_static/nwb_learning.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Teaching & Learning with NWB Datasets</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../landing_page.html">
   Teaching and Learning with NWB Datasets
  </a>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../Chapter_01/Data_Science_In_Python.html">
   1. Data Science in Python
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter_01/NumPy.html">
     1.3. NumPy
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter_01/Pandas.html">
     1.4. Pandas
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter_01/SciPy.html">
     1.5. SciPy
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../Chapter_02/Obtaining_and_Working_with_NWB_Datasets.html">
   2. Obtaining and Working with NWB Datasets
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter_02/Obtaining_Datasets_with_DANDI.html">
     2.1. Obtaining Datasets with DANDI
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter_02/Working_with_NWB_format_in_Python.html">
     2.2. Working with NWB in Python
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter_02/Chapter_2_ProblemSet.html">
     2.3. Chapter 2 Problem Set
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../Chapter_03/Large_Scale_Electrophysiology.html">
   3. Large Scale Electrophysiology
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter_03/Visualizing_Large_Scale_Recordings.html">
     3.1. Visualizing Large Scale Recordings
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter_03/Obtaining_Raw_Electrophysiology_Data.html">
     3.2. Obtaining  Electrophysiology Data from the AllenSDK
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter_03/Aligning_Spike_Trains_with_Stimuli_and_Behavior.html">
     3.3. Aligning Spike Trains with Visual Stimuli and Behavior
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter_03/Identifying_Cells_with_Optogenetics.html">
     3.4. Identifying Cells with Optogenetics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter_03/Chapter_3_ProblemSet.html">
     3.5. Chapter 3 Problem Set
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="Single-Cell_Electrophysiology.html">
   4. Single-Cell Electrophysiology
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     4.1. Obtaining Data for Single Cells
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Analyzing_Computed_Features.html">
     4.2. Analyzing Computed Features
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../Chapter_05/Two_Photon_Imaging.html">
   5. Two Photon Imaging
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter_05/Excitatory_Inhibitory_Decisions.html">
     5.1. Decision Making in Excitatory &amp; Inhibitory Cells
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter_05/Retrieving_Brain_Observatory_Data.html">
     5.2. Retrieving Calcium Imaging Data from the AllenSDK
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter_05/Analyzing_Two_Photon_Data.html">
     5.3. Analyzing Two Photon Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter_05/Correlations_in_Two_Photon_Data.html">
     5.4. Correlations in Two Photon Data
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/Chapter_04/Obtaining_Data_For_Single_Cells.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/NeuralDataScience/NeuralDataScience.github.io/master?urlpath=tree/Chapter_04/Obtaining_Data_For_Single_Cells.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/NeuralDataScience/NeuralDataScience.github.io/blob/master/Chapter_04/Obtaining_Data_For_Single_Cells.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="../_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#get-available-cells">
   4.1.1. Get Available Cells
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#get-morphology-data">
   4.1.2. Get Morphology data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#get-electrophysiology-data">
   4.1.3. Get Electrophysiology Data
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="obtaining-data-for-single-cells">
<h1><span class="section-number">4.1. </span>Obtaining Data for Single Cells<a class="headerlink" href="#obtaining-data-for-single-cells" title="Permalink to this headline">¶</a></h1>
<p>This section will serve as an introduction to the Allen Cell Types database. We’ll work with the AllenSDK to see what information we can gain about our cells.</p>
<p>First, let’s make sure you have an updated version of the Allen Institute Database installed. If you do not have the version below, this cell will install it for you. There is more information on installing the AllenSDK in the <a href="http://alleninstitute.github.io/AllenSDK/install.html">install guide</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># This will ensure that the AllenSDK is installed.</span>
<span class="c1"># If not, it will install it for you.</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">allensdk</span>
    <span class="k">if</span> <span class="n">allensdk</span><span class="o">.</span><span class="n">__version__</span> <span class="o">==</span> <span class="s1">&#39;2.11.2&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;allensdk already installed.&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span> 
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;incompatible version of allensdk installed&#39;</span><span class="p">)</span>
        <span class="o">!</span>pip install <span class="nv">allensdk</span><span class="o">==</span><span class="m">2</span>.11.2
<span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="o">!</span>pip install <span class="nv">allensdk</span><span class="o">==</span><span class="m">2</span>.11.2
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>allensdk already installed.
</pre></div>
</div>
</div>
</div>
<p>Next, we’ll <code class="docutils literal notranslate"><span class="pre">import</span></code> the CellTypesCache module. This module provides tools to allow us to access information from the Allen Cell Types database. We’re passing it a <strong>manifest</strong> filename as well. CellTypesCache will store the data in the path specified by the manifest filename. You can look under cell_types in your directory, and take a look at the file.</p>
<p>If you’re curious, you can see the full source documentation for the core package on the <a href="https://allensdk.readthedocs.io/en/latest/allensdk.core.html">Allen Brain Atlas website</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import the &quot;Cell Types Cache&quot; from the AllenSDK core package</span>
<span class="kn">from</span> <span class="nn">allensdk.core.cell_types_cache</span> <span class="kn">import</span> <span class="n">CellTypesCache</span>

<span class="c1"># Import CellTypesApi, which will allow us to query the database.</span>
<span class="kn">from</span> <span class="nn">allensdk.api.queries.cell_types_api</span> <span class="kn">import</span> <span class="n">CellTypesApi</span>

<span class="c1"># Import packages </span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span> 
<span class="o">%</span><span class="k">matplotlib</span> inline 
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>

<span class="c1"># We&#39;ll then initialize the cache as &#39;ctc&#39; (cell types cache)</span>
<span class="n">ctc</span> <span class="o">=</span> <span class="n">CellTypesCache</span><span class="p">(</span><span class="n">manifest_file</span><span class="o">=</span><span class="s1">&#39;cell_types/manifest.json&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Packages were successfully imported.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Packages were successfully imported.
</pre></div>
</div>
</div>
</div>
<div class="section" id="get-available-cells">
<h2><span class="section-number">4.1.1. </span>Get Available Cells<a class="headerlink" href="#get-available-cells" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">get_cells()</span></code> method downloads metadata for cells in the database. The database contains human cells and mouse cells. By default, <code class="docutils literal notranslate"><span class="pre">get_cells()</span></code> downloads metadata for <em>all</em> cells in the database. Alternatively, you can filter the database to only include cells collected from a certain species.
Look through <a href="https://allensdk.readthedocs.io/en/latest/allensdk.core.cell_types_cache.html">the documentation for the CellTypesCache</a> for more information on the <code class="docutils literal notranslate"><span class="pre">get_cells</span></code> method.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Download metadata for all cells in the database</span>
<span class="n">all_cells</span> <span class="o">=</span> <span class="n">ctc</span><span class="o">.</span><span class="n">get_cells</span><span class="p">()</span>

<span class="c1"># Convert it to a dataframe with the cell id as the index</span>
<span class="n">all_cells_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">all_cells</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Number of cells:&#39;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">all_cells_df</span><span class="p">))</span>
<span class="n">all_cells_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of cells: 2333
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>reporter_status</th>
      <th>cell_soma_location</th>
      <th>species</th>
      <th>name</th>
      <th>structure_layer_name</th>
      <th>structure_area_id</th>
      <th>structure_area_abbrev</th>
      <th>transgenic_line</th>
      <th>dendrite_type</th>
      <th>apical</th>
      <th>reconstruction_type</th>
      <th>disease_state</th>
      <th>donor_id</th>
      <th>structure_hemisphere</th>
      <th>normalized_depth</th>
    </tr>
    <tr>
      <th>id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>525011903</th>
      <td>None</td>
      <td>[273.0, 354.0, 216.0]</td>
      <td>Homo Sapiens</td>
      <td>H16.03.003.01.14.02</td>
      <td>3</td>
      <td>12113</td>
      <td>FroL</td>
      <td></td>
      <td>spiny</td>
      <td>intact</td>
      <td>None</td>
      <td>epilepsy</td>
      <td>524848408</td>
      <td>right</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>565871768</th>
      <td>positive</td>
      <td>[8966.56330957526, 1429.52689052075, 8567.3896...</td>
      <td>Mus musculus</td>
      <td>Oxtr-2A-Cre;Ai14-293837.03.01.02</td>
      <td>5</td>
      <td>385</td>
      <td>VISp</td>
      <td>Oxtr-T2A-Cre</td>
      <td>aspiny</td>
      <td>NA</td>
      <td>None</td>
      <td></td>
      <td>563340157</td>
      <td>left</td>
      <td>0.582057</td>
    </tr>
    <tr>
      <th>469801138</th>
      <td>positive</td>
      <td>[7872.53138541818, 993.212032389272, 3127.1530...</td>
      <td>Mus musculus</td>
      <td>Pvalb-IRES-Cre;Ai14-170927.05.02.01</td>
      <td>4</td>
      <td>385</td>
      <td>VISp</td>
      <td>Pvalb-IRES-Cre</td>
      <td>aspiny</td>
      <td>NA</td>
      <td>None</td>
      <td></td>
      <td>319194354</td>
      <td>right</td>
      <td>0.469578</td>
    </tr>
    <tr>
      <th>528642047</th>
      <td>None</td>
      <td>[69.0, 254.0, 96.0]</td>
      <td>Homo Sapiens</td>
      <td>H16.06.009.01.02.06.05</td>
      <td>5</td>
      <td>12141</td>
      <td>MTG</td>
      <td></td>
      <td>aspiny</td>
      <td>NA</td>
      <td>None</td>
      <td>epilepsy</td>
      <td>528574320</td>
      <td>left</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>605889373</th>
      <td>positive</td>
      <td>[9400.0, 1520.74232706376, 2188.13845194139]</td>
      <td>Mus musculus</td>
      <td>Vipr2-IRES2-Cre;Slc32a1-T2A-FlpO;Ai65-337419.0...</td>
      <td>2/3</td>
      <td>385</td>
      <td>VISp</td>
      <td>Slc32a1-T2A-FlpO|Vipr2-IRES2-Cre</td>
      <td>aspiny</td>
      <td>NA</td>
      <td>None</td>
      <td></td>
      <td>605622695</td>
      <td>right</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>The Allen Institute for Brain Science uses transgenic mouse lines that have Cre-expressing cells to mark specific types of cells in the brain. Lets find out what cre-lines are availabe in our mouse data under the column <code class="docutils literal notranslate"><span class="pre">transgenic_line</span></code>.</p>
<p>We can take a look at how many different values are stored within a column using the <code class="docutils literal notranslate"><span class="pre">.unique()</span></code> method.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">all_cells_df</span><span class="p">[</span><span class="s1">&#39;transgenic_line&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;&#39;, &#39;Oxtr-T2A-Cre&#39;, &#39;Pvalb-IRES-Cre&#39;,
       &#39;Slc32a1-T2A-FlpO|Vipr2-IRES2-Cre&#39;, &#39;Cux2-CreERT2&#39;,
       &#39;Scnn1a-Tg3-Cre&#39;, &#39;Htr3a-Cre_NO152&#39;, &#39;Rorb-IRES2-Cre&#39;,
       &#39;Ctgf-T2A-dgCre&#39;, &#39;Nkx2-1-CreERT2&#39;, &#39;Vip-IRES-Cre&#39;,
       &#39;Chrna2-Cre_OE25&#39;, &#39;Nos1-CreERT2|Sst-IRES-FlpO&#39;, &#39;Scnn1a-Tg2-Cre&#39;,
       &#39;Nos1-CreERT2&#39;, &#39;Ntsr1-Cre_GN220&#39;, &#39;Esr2-IRES2-Cre&#39;,
       &#39;Tlx3-Cre_PL56&#39;, &#39;Vipr2-IRES2-Cre&#39;,
       &#39;Chrna2-Cre_OE25|Pvalb-T2A-Dre&#39;, &#39;Nr5a1-Cre&#39;, &#39;Ndnf-IRES2-dgCre&#39;,
       &#39;Sst-IRES-Cre&#39;, &#39;Gad2-IRES-Cre&#39;, &#39;Chat-IRES-Cre-neo&#39;,
       &#39;Slc17a6-IRES-Cre&#39;, &#39;Sim1-Cre_KJ18&#39;, &#39;Glt25d2-Cre_NF107&#39;,
       &#39;Rbp4-Cre_KL100&#39;, &#39;Penk-IRES2-Cre-neo&#39;,
       &#39;Htr3a-Cre_NO152|Pvalb-T2A-Dre&#39;, &#39;Esr2-IRES2-Cre|PhiC31-neo&#39;,
       &#39;Gng7-Cre_KH71&#39;, &#39;Pvalb-T2A-FlpO|Vipr2-IRES2-Cre&#39;,
       &#39;Pvalb-T2A-CreERT2&#39;, &#39;Esr2-IRES2-Cre-neo|PhiC31-neo&#39;,
       &#39;Esr2-IRES2-Cre-neo&#39;, &#39;Vipr2-IRES2-Cre-neo&#39;], dtype=object)
</pre></div>
</div>
</div>
</div>
<p>For more information on the Allen Cell Types Cre lines, please visit <a href="https://docs.google.com/document/d/1ZMMZgc7cS5BHhoWNqzjw95BdxOuj5wrYl9I7PV2HeUI/edit">the Allen Cell Types Cre Lines Glossary</a> for a short description of the cortical expression patterns of the transgenic Cre lines available in the Allen Cell Types dataset.</p>
</div>
<div class="section" id="get-morphology-data">
<h2><span class="section-number">4.1.2. </span>Get Morphology data<a class="headerlink" href="#get-morphology-data" title="Permalink to this headline">¶</a></h2>
<p>The dataframe above only contains metadeta about our cells and no information on the morphology or electrophysiology of our cells. In order to get information about the morphology of these cells, we need to use the <code class="docutils literal notranslate"><span class="pre">get_morphology_features()</span></code> method on our instance of the cell types cache. We will set the indices to be the <code class="docutils literal notranslate"><span class="pre">specimen_id</span></code> because these ids will align with those in <code class="docutils literal notranslate"><span class="pre">all_cells_df</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Downloads the morphology features and sets up the dataframe all in one line</span>
<span class="n">morphology_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">ctc</span><span class="o">.</span><span class="n">get_morphology_features</span><span class="p">())</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;specimen_id&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Length of dataframe:&#39;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">morphology_df</span><span class="p">))</span>
<span class="n">morphology_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Length of dataframe: 701
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>average_bifurcation_angle_local</th>
      <th>average_bifurcation_angle_remote</th>
      <th>average_contraction</th>
      <th>average_diameter</th>
      <th>average_fragmentation</th>
      <th>average_parent_daughter_ratio</th>
      <th>hausdorff_dimension</th>
      <th>id</th>
      <th>max_branch_order</th>
      <th>max_euclidean_distance</th>
      <th>...</th>
      <th>overall_width</th>
      <th>scale_factor_x</th>
      <th>scale_factor_y</th>
      <th>scale_factor_z</th>
      <th>soma_surface</th>
      <th>superseded</th>
      <th>tags</th>
      <th>total_length</th>
      <th>total_surface</th>
      <th>total_volume</th>
    </tr>
    <tr>
      <th>specimen_id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>478107198</th>
      <td>82.727781</td>
      <td>NaN</td>
      <td>0.864267</td>
      <td>0.345092</td>
      <td>20.723077</td>
      <td>0.964510</td>
      <td>NaN</td>
      <td>491119743</td>
      <td>6.0</td>
      <td>99.779724</td>
      <td>...</td>
      <td>136.267522</td>
      <td>0.1144</td>
      <td>0.1144</td>
      <td>0.28</td>
      <td>435.740270</td>
      <td>False</td>
      <td>3D Neuron Reconstruction morphology</td>
      <td>1666.082926</td>
      <td>1803.875644</td>
      <td>167.343086</td>
    </tr>
    <tr>
      <th>502367941</th>
      <td>82.506680</td>
      <td>NaN</td>
      <td>0.903890</td>
      <td>0.634047</td>
      <td>105.277778</td>
      <td>0.862183</td>
      <td>NaN</td>
      <td>546781359</td>
      <td>3.0</td>
      <td>432.383110</td>
      <td>...</td>
      <td>370.170045</td>
      <td>0.1144</td>
      <td>0.1144</td>
      <td>0.28</td>
      <td>1446.587725</td>
      <td>False</td>
      <td>3D Neuron Reconstruction morphology</td>
      <td>2277.259374</td>
      <td>4543.139073</td>
      <td>921.571895</td>
    </tr>
    <tr>
      <th>515771244</th>
      <td>77.536678</td>
      <td>NaN</td>
      <td>0.863104</td>
      <td>0.417929</td>
      <td>73.666667</td>
      <td>0.926633</td>
      <td>NaN</td>
      <td>537042261</td>
      <td>6.0</td>
      <td>373.630444</td>
      <td>...</td>
      <td>381.015114</td>
      <td>0.1144</td>
      <td>0.1144</td>
      <td>0.28</td>
      <td>287.118123</td>
      <td>False</td>
      <td>3D Neuron Reconstruction morphology</td>
      <td>3589.339062</td>
      <td>4704.910407</td>
      <td>582.285423</td>
    </tr>
    <tr>
      <th>561435279</th>
      <td>76.583222</td>
      <td>NaN</td>
      <td>0.900537</td>
      <td>0.400396</td>
      <td>95.979167</td>
      <td>0.942049</td>
      <td>NaN</td>
      <td>689123605</td>
      <td>11.0</td>
      <td>943.382549</td>
      <td>...</td>
      <td>524.550156</td>
      <td>0.1144</td>
      <td>0.1144</td>
      <td>0.28</td>
      <td>180.994813</td>
      <td>False</td>
      <td>3D Neuron Reconstruction morphology</td>
      <td>5416.228778</td>
      <td>6814.933290</td>
      <td>740.722806</td>
    </tr>
    <tr>
      <th>591268268</th>
      <td>72.019250</td>
      <td>NaN</td>
      <td>0.873518</td>
      <td>0.227626</td>
      <td>47.535714</td>
      <td>1.000000</td>
      <td>NaN</td>
      <td>657879305</td>
      <td>5.0</td>
      <td>186.218009</td>
      <td>...</td>
      <td>261.459057</td>
      <td>0.1144</td>
      <td>0.1144</td>
      <td>0.28</td>
      <td>55.055236</td>
      <td>False</td>
      <td>3D Neuron Reconstruction morphology</td>
      <td>1659.465869</td>
      <td>1185.773462</td>
      <td>69.144146</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 29 columns</p>
</div></div></div>
</div>
<p>Now we have two dataframes, one with the metadata for our cells, indexed by id, and another with the morphology data for all cells, also indexed by id. Usefully, these ids are unique to each cell, meaning we can match them across dataframes.</p>
<p>We’ll use <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.join.html">join</a> to unite our dataframes. Since for the moment we’re only interested in cells that have morphology data, we’ll <strong>join</strong> the dataframes “on the right,” effectively dropping all of the cells that are not in the morphology dataframe.</p>
<p><strong>Note</strong>: Above, in get the <code class="docutils literal notranslate"><span class="pre">get_cells()</span></code> method, you can also restrict to experiments with morphology data by usnig the <code class="docutils literal notranslate"><span class="pre">require_morphology</span> <span class="pre">=</span> <span class="pre">True</span></code> argument.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Combine our metadata with our morphology data</span>
<span class="n">meta_morph_df</span> <span class="o">=</span> <span class="n">all_cells_df</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">morphology_df</span><span class="p">,</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Number of cells:&#39;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">meta_morph_df</span><span class="p">))</span>
<span class="n">meta_morph_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of cells: 701
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>reporter_status</th>
      <th>cell_soma_location</th>
      <th>species</th>
      <th>name</th>
      <th>structure_layer_name</th>
      <th>structure_area_id</th>
      <th>structure_area_abbrev</th>
      <th>transgenic_line</th>
      <th>dendrite_type</th>
      <th>apical</th>
      <th>...</th>
      <th>overall_width</th>
      <th>scale_factor_x</th>
      <th>scale_factor_y</th>
      <th>scale_factor_z</th>
      <th>soma_surface</th>
      <th>superseded</th>
      <th>tags</th>
      <th>total_length</th>
      <th>total_surface</th>
      <th>total_volume</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>313861608</th>
      <td>positive</td>
      <td>[9349.44051500564, 1314.78991021449, 3245.6530...</td>
      <td>Mus musculus</td>
      <td>Pvalb-IRES-Cre;Ai14-165874.04.02.01</td>
      <td>5</td>
      <td>385</td>
      <td>VISp</td>
      <td>Pvalb-IRES-Cre</td>
      <td>aspiny</td>
      <td>NA</td>
      <td>...</td>
      <td>358.994232</td>
      <td>0.1144</td>
      <td>0.1144</td>
      <td>0.28</td>
      <td>514.500853</td>
      <td>False</td>
      <td>3D Neuron Reconstruction morphology</td>
      <td>3538.876780</td>
      <td>6041.095769</td>
      <td>945.093080</td>
    </tr>
    <tr>
      <th>313862022</th>
      <td>positive</td>
      <td>[9489.24257509068, 1423.65239028148, 2785.4430...</td>
      <td>Mus musculus</td>
      <td>Scnn1a-Tg2-Cre;Ai14-167081.03.02.01</td>
      <td>4</td>
      <td>385</td>
      <td>VISp</td>
      <td>Scnn1a-Tg2-Cre</td>
      <td>spiny</td>
      <td>intact</td>
      <td>...</td>
      <td>287.122628</td>
      <td>0.1144</td>
      <td>0.1144</td>
      <td>0.28</td>
      <td>268.777679</td>
      <td>False</td>
      <td>3D Neuron Reconstruction morphology</td>
      <td>3498.090031</td>
      <td>3523.606841</td>
      <td>306.290931</td>
    </tr>
    <tr>
      <th>313862167</th>
      <td>positive</td>
      <td>[9279.53948496313, 1831.03502009105, 2151.2443...</td>
      <td>Mus musculus</td>
      <td>Sst-IRES-Cre;Ai14-167638.05.02.01</td>
      <td>4</td>
      <td>409</td>
      <td>VISl</td>
      <td>Sst-IRES-Cre</td>
      <td>aspiny</td>
      <td>NA</td>
      <td>...</td>
      <td>327.150383</td>
      <td>0.1144</td>
      <td>0.1144</td>
      <td>0.28</td>
      <td>361.118559</td>
      <td>False</td>
      <td>3D Neuron Reconstruction morphology</td>
      <td>2644.878298</td>
      <td>3883.698604</td>
      <td>512.836253</td>
    </tr>
    <tr>
      <th>313862167</th>
      <td>positive</td>
      <td>[9279.53948496313, 1831.03502009105, 2151.2443...</td>
      <td>Mus musculus</td>
      <td>Sst-IRES-Cre;Ai14-167638.05.02.01</td>
      <td>4</td>
      <td>409</td>
      <td>VISl</td>
      <td>Sst-IRES-Cre</td>
      <td>aspiny</td>
      <td>NA</td>
      <td>...</td>
      <td>327.150383</td>
      <td>0.1144</td>
      <td>0.1144</td>
      <td>0.28</td>
      <td>361.118559</td>
      <td>True</td>
      <td>3D Neuron Reconstruction morphology</td>
      <td>2644.878347</td>
      <td>3883.699514</td>
      <td>512.835043</td>
    </tr>
    <tr>
      <th>313862306</th>
      <td>positive</td>
      <td>[8976.63502144556, 1878.14058922573, 8881.4968...</td>
      <td>Mus musculus</td>
      <td>Sst-IRES-Cre;Ai14-167636.04.01.01</td>
      <td>6a</td>
      <td>385</td>
      <td>VISp</td>
      <td>Sst-IRES-Cre</td>
      <td>aspiny</td>
      <td>NA</td>
      <td>...</td>
      <td>242.781213</td>
      <td>0.1144</td>
      <td>0.1144</td>
      <td>0.28</td>
      <td>94.306278</td>
      <td>False</td>
      <td>3D Neuron Reconstruction morphology</td>
      <td>2502.160541</td>
      <td>1994.902243</td>
      <td>141.878464</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 44 columns</p>
</div></div></div>
</div>
<p>The Cell Types Database also contains 3D reconstructions of neuronal morphologies. You can create these single cell reconstructions by executing the <code class="docutils literal notranslate"><span class="pre">get_reconstruction()</span></code> method on your instance of the cells type cache. To do so, you must specify what cell you want to reconstruct by inputing a <code class="docutils literal notranslate"><span class="pre">specimen_id</span></code>. This method returns a class instance with methods for accessing morphology compartments.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get the cell_id for the first cell in our dataframe</span>
<span class="n">cell_id</span> <span class="o">=</span> <span class="n">meta_morph_df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># Call for recontruction of desired cell</span>
<span class="n">single_cell_morphology</span> <span class="o">=</span> <span class="n">ctc</span><span class="o">.</span><span class="n">get_reconstruction</span><span class="p">(</span><span class="n">specimen_id</span> <span class="o">=</span> <span class="n">cell_id</span><span class="p">)</span>

<span class="c1"># Get summary of cell reconstruction </span>
<span class="n">single_cell_morphology</span><span class="o">.</span><span class="n">soma</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;id&#39;: 0,
 &#39;type&#39;: 1,
 &#39;x&#39;: 396.0425,
 &#39;y&#39;: 368.9697,
 &#39;z&#39;: 26.6608,
 &#39;radius&#39;: 6.4254,
 &#39;parent&#39;: -1,
 &#39;tree_id&#39;: 0,
 &#39;children&#39;: [1, 487, 982, 1101, 1664, 1872, 2379, 3077]}
</pre></div>
</div>
</div>
</div>
<p>We now have a dictionary of our cell reconstruction. Note that the type field refers to the type of neuronal compartment. The values can be 1 for the soma, 2 for the axon, 3 for dendrites, and 4 for apical dendrites (if present). The x, y, and z, represent the spatial location of the cell soma.</p>
<p>Morphologies also come with marker files, which contain points of interest in the reconstruction. The marker file contains locations where dendrites have been truncated due to slicing and when axons were not reconstructed. The <code class="docutils literal notranslate"><span class="pre">name</span></code> field indicates the type of marker (10 for dendrite truncation, 20 for no reconstruction).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Download and store markers for 3D reconstruction </span>
<span class="n">markers</span> <span class="o">=</span> <span class="n">ctc</span><span class="o">.</span><span class="n">get_reconstruction_markers</span><span class="p">(</span><span class="n">cell_id</span><span class="p">)</span> 
<span class="n">markers</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[{&#39;x&#39;: 417.1024, &#39;y&#39;: 252.13760000000002, &#39;z&#39;: 18.48, &#39;name&#39;: 10},
 {&#39;x&#39;: 411.4968, &#39;y&#39;: 325.0104, &#39;z&#39;: 18.48, &#39;name&#39;: 10},
 {&#39;x&#39;: 429.4576, &#39;y&#39;: 364.1352, &#39;z&#39;: 19.32, &#39;name&#39;: 10},
 {&#39;x&#39;: 378.3208, &#39;y&#39;: 363.3344, &#39;z&#39;: 17.36, &#39;name&#39;: 10},
 {&#39;x&#39;: 393.8792, &#39;y&#39;: 404.5184, &#39;z&#39;: 17.08, &#39;name&#39;: 10},
 {&#39;x&#39;: 386.9008, &#39;y&#39;: 309.2232, &#39;z&#39;: 19.88, &#39;name&#39;: 10},
 {&#39;x&#39;: 366.652, &#39;y&#39;: 503.5888, &#39;z&#39;: 24.08, &#39;name&#39;: 10},
 {&#39;x&#39;: 546.2244999999999, &#39;y&#39;: 189.7084, &#39;z&#39;: 129.2262, &#39;name&#39;: 10},
 {&#39;x&#39;: 529.3048, &#39;y&#39;: 413.3364, &#39;z&#39;: 99.47279999999999, &#39;name&#39;: 10},
 {&#39;x&#39;: 442.8424, &#39;y&#39;: 473.616, &#39;z&#39;: 101.36, &#39;name&#39;: 10},
 {&#39;x&#39;: 374.7744, &#39;y&#39;: 475.904, &#39;z&#39;: 86.24, &#39;name&#39;: 10},
 {&#39;x&#39;: 541.3716999999999, &#39;y&#39;: 216.2698, &#39;z&#39;: 85.21379999999999, &#39;name&#39;: 10},
 {&#39;x&#39;: 431.7868, &#39;y&#39;: 205.0448, &#39;z&#39;: 89.7428, &#39;name&#39;: 10},
 {&#39;x&#39;: 614.0992, &#39;y&#39;: 300.9864, &#39;z&#39;: 83.44, &#39;name&#39;: 10},
 {&#39;x&#39;: 383.09360000000004, &#39;y&#39;: 371.9785, &#39;z&#39;: 16.929599999999997, &#39;name&#39;: 20},
 {&#39;x&#39;: 396.1077, &#39;y&#39;: 368.7706, &#39;z&#39;: 17.968999999999998, &#39;name&#39;: 30}]
</pre></div>
</div>
</div>
</div>
<p>We can use this data to draw lines between each node and all its children to get a drawing of the cell. We’ll reconstruct an image from the front and side view of our cell.</p>
<p><strong>Note</strong>: Since we’re reconstructing what is likely to be a very complicated neuron, this might take a minute to plot.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import necessary toolboxes</span>
<span class="kn">from</span> <span class="nn">allensdk.core.swc</span> <span class="kn">import</span> <span class="n">Marker</span>

<span class="c1"># Set up our plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>

<span class="c1"># Make a line drawing of x-y and y-z views</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">single_cell_morphology</span><span class="o">.</span><span class="n">compartment_list</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">single_cell_morphology</span><span class="o">.</span><span class="n">children_of</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">n</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]],</span> <span class="p">[</span><span class="n">n</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">],</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">n</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">],</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">]],</span> <span class="p">[</span><span class="n">n</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">],</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>

<span class="c1"># Plot cut dendrite markers in red</span>
<span class="n">dm</span> <span class="o">=</span> <span class="p">[</span> <span class="n">m</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">markers</span> <span class="k">if</span> <span class="n">m</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">Marker</span><span class="o">.</span><span class="n">CUT_DENDRITE</span> <span class="p">]</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">dm</span><span class="p">],</span> <span class="p">[</span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">dm</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">dm</span><span class="p">],</span> <span class="p">[</span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">dm</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>

<span class="c1"># Plot no reconstruction markers in blue</span>
<span class="n">nm</span> <span class="o">=</span> <span class="p">[</span> <span class="n">m</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">markers</span> <span class="k">if</span> <span class="n">m</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">Marker</span><span class="o">.</span><span class="n">NO_RECONSTRUCTION</span> <span class="p">]</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">nm</span><span class="p">],</span> <span class="p">[</span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">nm</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">nm</span><span class="p">],</span> <span class="p">[</span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">nm</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Front View&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Side View&#39;</span><span class="p">)</span>

<span class="c1"># Show the plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/Obtaining_Data_For_Single_Cells_20_0.png" src="../_images/Obtaining_Data_For_Single_Cells_20_0.png" />
</div>
</div>
</div>
<div class="section" id="get-electrophysiology-data">
<h2><span class="section-number">4.1.3. </span>Get Electrophysiology Data<a class="headerlink" href="#get-electrophysiology-data" title="Permalink to this headline">¶</a></h2>
<p>Now that we know what our cell looks like, let’s take a look at its action potentials. The <code class="docutils literal notranslate"><span class="pre">get_ephys_data()</span></code> method can download electrophysiology traces for a single cell in the database. This method returns a class instance with helper methods for retrieving stimulus and response traces out of an NWB file. If we take a look at <code class="docutils literal notranslate"><span class="pre">specimen_ephys_data</span></code> we can see that it is an NWBDataSet object.  In order to use <code class="docutils literal notranslate"><span class="pre">get_ephys_data()</span></code>, you must specify the id of the cell specimen whose electrophysiology you would like to download.</p>
<p>Below we go over methods that can be used to access the electrophysiology data for single cells, the source documentation for all the methods we cover can be found on the <a href = 'https://allensdk.readthedocs.io/en/latest/allensdk.core.nwb_data_set.html'> Allen Brain Atlas website</a>. The <code class="docutils literal notranslate"><span class="pre">get_experiment_sweep_numbers()</span></code> method returns all of the sweep numbers for experiments in the file. Each sweep contains metadata and electrophysiology data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get electrophysiological traces of our cell</span>
<span class="n">specimen_ephys_data</span> <span class="o">=</span> <span class="n">ctc</span><span class="o">.</span><span class="n">get_ephys_data</span><span class="p">(</span><span class="n">specimen_id</span> <span class="o">=</span> <span class="n">cell_id</span><span class="p">)</span>

<span class="c1"># Retrieve sweep numbers for cell</span>
<span class="n">sweep_numbers</span> <span class="o">=</span> <span class="n">specimen_ephys_data</span><span class="o">.</span><span class="n">get_experiment_sweep_numbers</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">specimen_ephys_data</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sweep_numbers</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;allensdk.core.nwb_data_set.NwbDataSet&#39;&gt;
[10, 100, 101, 102, 103, 104, 105, 108, 11, 12, 13, 14, 15, 17, 18, 19, 20, 21, 23, 24, 25, 26, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 39, 4, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 5, 50, 51, 52, 53, 54, 55, 57, 58, 59, 6, 60, 61, 62, 63, 64, 65, 66, 68, 69, 7, 71, 72, 73, 74, 75, 76, 77, 78, 79, 8, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 9, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99]
</pre></div>
</div>
</div>
</div>
<p>Now that we have sweep numbers to choose from, we can take a look at a sweep’s metadata by calling get_sweep_metadata(). This returns a dictionary containing information such as stimulus paramaters and recording quality.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Select a sweep number </span>
<span class="n">sweep_number</span> <span class="o">=</span> <span class="n">sweep_numbers</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># Retrieve metadata for selected sweep</span>
<span class="n">specimen_metadata</span> <span class="o">=</span> <span class="n">specimen_ephys_data</span><span class="o">.</span><span class="n">get_sweep_metadata</span><span class="p">(</span><span class="n">sweep_number</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">specimen_metadata</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;aibs_stimulus_amplitude_pa&#39;: 420.0, &#39;aibs_stimulus_name&#39;: &#39;Short Square - Triple&#39;, &#39;gain&#39;: 0.01, &#39;initial_access_resistance&#39;: 15.208168, &#39;seal&#39;: 1.4909363}
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">get_sweep()</span></code> method returns a dictionary containing the stimulus, response, index_range, and sampling rate for a particular sweep.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sweep_data</span> <span class="o">=</span> <span class="n">specimen_ephys_data</span><span class="o">.</span><span class="n">get_sweep</span><span class="p">(</span><span class="n">sweep_number</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sweep_data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;stimulus&#39;: array([0., 0., 0., ..., 0., 0., 0.], dtype=float32), &#39;response&#39;: array([-0.07440625, -0.0744375 , -0.074375  , ..., -0.07428125,
       -0.074375  , -0.07428125], dtype=float32), &#39;stimulus_unit&#39;: &#39;Amps&#39;, &#39;index_range&#39;: (150000, 618600), &#39;sampling_rate&#39;: 200000.0}
</pre></div>
</div>
</div>
</div>
<p>Now that you’ve pulled down some data, chosen a cell, and chosen a sweep number, let’s plot that data. We can look closer at the action potential by plotting the raw recording. Our <code class="docutils literal notranslate"><span class="pre">sweep_data</span></code> variable has all the data we need to plot our sweep; the stimulus current injected into our cell, the cell’s response, and sampling rate of the sweep.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get the stimulus trace (in amps) and convert to pA</span>
<span class="n">stim_current</span> <span class="o">=</span> <span class="n">sweep_data</span><span class="p">[</span><span class="s1">&#39;stimulus&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1e12</span>

<span class="c1"># Get the voltage trace (in volts) and convert to mV</span>
<span class="n">response_voltage</span> <span class="o">=</span> <span class="n">sweep_data</span><span class="p">[</span><span class="s1">&#39;response&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1e3</span>

<span class="c1"># Get the sampling rate and can create a time axis for our data</span>
<span class="n">sampling_rate</span> <span class="o">=</span> <span class="n">sweep_data</span><span class="p">[</span><span class="s1">&#39;sampling_rate&#39;</span><span class="p">]</span> <span class="c1"># in Hz</span>
<span class="n">timestamps</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">response_voltage</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">sampling_rate</span><span class="p">))</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">9</span><span class="p">))</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Cell: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">cell_id</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;, Sweep: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">sweep_number</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">timestamps</span><span class="p">,</span> <span class="n">response_voltage</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Cell Response (mV)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">timestamps</span><span class="p">,</span> <span class="n">stim_current</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time (sec)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Input Current (nA)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="mf">2.2</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/Obtaining_Data_For_Single_Cells_28_0.png" src="../_images/Obtaining_Data_For_Single_Cells_28_0.png" />
</div>
</div>
<p>That’s how you can dig into the morphology and raw electrophysiology traces for single cells. In the next notebook, we’ll take a look at some of the features of these action potentials.</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./Chapter_04"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="Single-Cell_Electrophysiology.html" title="previous page"><span class="section-number">4. </span>Single-Cell Electrophysiology</a>
    <a class='right-next' id="next-link" href="Analyzing_Computed_Features.html" title="next page"><span class="section-number">4.2. </span>Analyzing Computed Features</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Victor Magdaleno-Garcia & Ashley Juavinett<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>